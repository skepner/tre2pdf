# tre2pdf
Set of tools to generate pdf of phylogenetic tree

## Processing

Note: <input.json> and <output.json> can be replaced with - to allow reading/writing from/to stdin/stdout.

* Convert tree in the newick format to json supported by this tools.

        ./dist/newick2json <input.tre> <output.json>

* Add continent information.

    Uses acmacs API to parse sequence names and obtain continent information for them.

        ./scripts/tre-continent --acmacs=https://localhost:1168 <input.json> <output.json>

* Add clade information (uses seqdb)

        ./scripts/tre-seqdb --clade <input.json> output.json>

    Sample clade-desc.json:

        {
            "H3": {
                "comment": "158N, 159F -> 3C, 159Y -> 3c2a, 159S -> 3c3a, 160S -> gly, 160T -> gly, 160x -> no gly",
                "clades": [
                    {"clade": "3C3", "positions": [{"pos": 158, "aa": "N"}, {"pos": 159, "aa": "F"}]},
                    {"clade": "3C2a", "positions": [{"pos": 158, "aa": "N"}, {"pos": 159, "aa": "Y"}]},
                    {"clade": "3C3a", "positions": [{"pos": 158, "aa": "N"}, {"pos": 159, "aa": "S"}]}
                ]
            },
            "B": {
                "comment": "165N - Y2, 165Y - Y3",
                "clades": [
                    {"clade": "Y2", "positions": [{"pos": 165, "aa": "N"}]},
                    {"clade": "Y3", "positions": [{"pos": 165, "aa": "Y"}]}
                ]
            }
        }

* Add amino acid at given pos information (uses seqdb)

        ./scripts/tre-seqdb --pos <pos,pos,pos> <input.json> output.json>

* Add branch annotations for amino acid transition

        ./scripts/tre-seqdb --branch-annotations --branch-ids <input.json> output.json>

* Generate pdf.

        ./dist/tre2pdf --continents --clades --fix-labels --number-strains-threshold=20 --show-branch-ids --show-subtree-top-bottom <input.json> <output.pdf>

* Do everything using pipe.

        ./dist/newick2json <input.tre> - | ./scripts/tre-continent --acmacs=https://localhost:1168 - - | ./scripts/tre-clade - <sequences.fasta> <clade-desc.json> - | ./dist/tre2pdf --continents --clades --fix-labels - <output.pdf>

* Adjusting various settings.

    Program generates "_settings" key in the output json. It is
    generated by newick2json and it is not touched by tre-continent,
    tre-clade. You may edit various settings, some of them could be
    set ot negative numbers, then program uses defaults or
    re-calculates those values.

* Title

        _settings.title: {"label": "B/Yam", "font_size": 20, "label_x": 10, "label_y": 25, "label_color": "#000000"}

* Horizontal lines in time series

        _settings.time_series.subtree_top_bottom:
        [
          {"branch_id": "1.13.2.1.1.1.2.104.18", "line_color": "#808080", "line_width": 0.2, "show": true},
          {"branch_id": "1.13.2.1.1.1.2.104.19.12", "line_color": "#808080", "line_width": 0.2, "show": true},
          {"branch_id": "1.13.2.1.1.1", "draw_bottom": false, "line_color": "#808080", "line_width": 0.2, "show": true},
          {"branch_id": "1.13.2.1.1.1.2.100", "line_color": "#808080", "line_width": 0.2, "show": true},
          {"branch_id": "1.13.2.1.1.1.2.104", "draw_bottom": false, "line_color": "#808080", "line_width": 0.2, "show": true},
          {"branch_id": "1.13.2.1.1.1.2.104.15", "draw_bottom": false, "line_color": "#808080", "line_width": 0.2, "show": true},
          {"branch_id": "1.13.2.1.1.1.2.104.17", "draw_bottom": false, "line_color": "#808080", "line_width": 0.2, "show": true},
          {"branch_id": "", "line_color": "#808080", "line_width": 0.2, "show": true},
          {"branch_id": "", "line_color": "#808080", "line_width": 0.2, "show": true}
          ]

* Branch annotations

        _settings.tree.branch_annotations:
        [
          {"branch_id": "1.13.2", "color": "#000000", "font_size": 10, "label_interleave": 1.2, "label_offset_x": 0.0, "label_offset_y": 0.0, "line_color": "#000000", "line_width": 0.5, "line_x": -10.0, "line_y": 5.0, "show": true, "show_line": false},
          {"branch_id": "1.11.1", "color": "#000000", "font_size": 10, "label_interleave": 1.2, "label_offset_x": 0.0, "label_offset_y": 0.0, "line_color": "#000000", "line_width": 0.5, "line_x": -10.0, "line_y": 5.0, "show": true, "show_line": false},
          {"branch_id": "1.13.2.1", "label": "N166Y\nK299E", "color": "#000000", "font_size": 10, "label_interleave": 1.2, "label_offset_x": 0.0, "label_offset_y": 0.0, "line_color": "#000000", "line_width": 0.5, "line_x": -10.0, "line_y": 5.0, "show": true, "show_line": false},
          {"branch_id": "1.13.2.1.1", "label": "N116K\nA182T\nN203S", "color": "#000000", "font_size": 10, "label_interleave": 1.2, "label_offset_x": 0.0, "label_offset_y": 0.0, "line_color": "#000000", "line_width": 0.5, "line_x": -10.0, "line_y": 5.0, "show": true, "show_line": false},
          {"branch_id": "1.13.2.1.1.0", "label": "K88R\nM252V\nE313K", "color": "#000000", "font_size": 10, "label_interleave": 1.2, "label_offset_x": 0.0, "label_offset_y": 0.0, "line_color": "#000000", "line_width": 0.5, "line_x": -10.0, "line_y": 5.0, "show": true, "show_line": false},
          {"branch_id": "1.13.2.1.1.1", "label": "K122Q\nR212K", "color": "#000000", "font_size": 10, "label_interleave": 1.2, "label_offset_x": 0.0, "label_offset_y": 0.0, "line_color": "#000000", "line_width": 0.5, "line_x": -10.0, "line_y": 5.0, "show": true, "show_line": false},
          {"branch_id": "1.13.2.1.1.1.2", "label": "L173Q\nM252I", "color": "#000000", "font_size": 10, "label_interleave": 1.2, "label_offset_x": 0.0, "label_offset_y": 0.0, "line_color": "#000000", "line_width": 0.5, "line_x": -10.0, "line_y": 5.0, "show": true, "show_line": false},
          {"branch_id": "1.13.2.1.1.1.2.104", "color": "#000000", "font_size": 10, "label_interleave": 1.2, "label_offset_x": 0.0, "label_offset_y": 0.0, "line_color": "#000000", "line_width": 0.5, "line_x": -10.0, "line_y": 5.0, "show": true, "show_line": false},
          {"branch_id": "1.13.2.1.1.1.2.104.17.2", "color": "#000000", "font_size": 10, "label_interleave": 1.2, "label_offset_x": 0.0, "label_offset_y": 0.0, "line_color": "#000000", "line_width": 0.5, "line_x": -10.0, "line_y": 5.0, "show": true, "show_line": false},
          {"branch_id": "1.13.2.1.1.1.2.104.19.13.23", "color": "#000000", "font_size": 10, "label_interleave": 1.2, "label_offset_x": 0.0, "label_offset_y": 0.0, "line_color": "#000000", "line_width": 0.5, "line_x": -10.0, "line_y": 5.0, "show": true, "show_line": false}
       ]
